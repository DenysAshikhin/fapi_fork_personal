"use strict";(self.webpackChunkfapi=self.webpackChunkfapi||[]).push([[359],{5359:function(t,e,a){var o=a(1413),r=a(3433),i={roundTwoDecimal:function(t){return Math.round(100*(t+Number.EPSILON))/100},roundThreeDecimal:function(t){return Math.round(1e3*(t+Number.EPSILON))/1e3},roundInt:function(t){return Math.round(1*(t+Number.EPSILON))/1},calculateLogarithm:function(t,e){return Math.log(e)/Math.log(t)},calcPOW:function(t){return t.mantissa*Math.pow(10,t.exponent)},secondsToStringWithS:function(t){var e,a,o,r="";return e=Math.floor(t/3600),a=Math.floor(t%3600/60),o=this.roundInt(t%3600%60),e>0&&(r+="".concat(e<10?"0"+e:e,"h:")),a>0&&(r+="".concat(a<10?"0"+a:a,"m:")),r+=o>0?"".concat(o<10?"0"+o:o,"s"):"0s"},secondsToString:function(t){var e,a,o="";return e=Math.floor(t/3600),a=this.roundInt(t%3600/60),e>0&&(o+="".concat(e<10?"0"+e:e,"h:")),o+=a>0?"".concat(a<10?"0"+a:a,"m"):"0s"},bonusColorMap:{1001:{color:"maroon"},1002:{color:"orange"},1003:{color:"purple"},1009:{color:"cyan"},1012:{color:"yellow"},1013:{color:"red"},1014:{color:"blue"},1015:{color:"gray"},1016:{color:"green"}}},n=a(9298),l={createDecimal:function(t){return t.mantissa||0===t.mantissa?new n.Z("".concat(t.mantissa,"e").concat(t.exponent)):new n.Z(t)},multiplyDecimal:function(t,e){return(t=t.mantissa||0===t.mantissa?t:this.createDecimal(t)).times(e)},divideDecimal:function(t,e){return(t=t.mantissa||0===t.mantissa?t:this.createDecimal(t)).dividedBy(e)},addDecimal:function(t,e){return(t=t.mantissa||0===t.mantissa?t:this.createDecimal(t)).plus(e)},subtractDecimal:function(t,e){return(t=t.mantissa||0===t.mantissa?t:this.createDecimal(t)).minus(e)},logDecimal:function(t,e){return t=t.mantissa||0===t.mantissa?t:this.createDecimal(t),this.createDecimal(t.log(e))},pow:function(t,e){return(t=t.mantissa||0===t.mantissa?t:this.createDecimal(t)).pow(e)}},s={findMultipliersWithMinPercentage:function(t,e,a){var o=[],i=0;return function n(l,s,c){if(i++,l!==e.length)for(var u=Math.floor((t-s)/e[l]),p=0;p<=u;p++){c[l]=p,s+p*e[l]<t&&n(l+1,s+p*e[l],c)}else{var m=c.reduce((function(t,a,o){return t+a*e[o]}),0);m>=a*t&&o.push((0,r.Z)(c))}}(0,0,[]),console.log(i),o},calcGrowthTime:function(t,e){var a=Math.floor(t.TimeNeeded/t.prestigeBonus/(1+.05*e.shopGrowingSpeed)/e.petPlantCombo/e.contagionPlantGrowth);return a<10?10:a},calcPlantHarvest:function(t,e){return i.roundInt((1+t.Rank)*Math.pow(1.05,t.Rank))*Math.pow(1.02,t.prestige)*e.contagionHarvest},calcShopProdBonus:function(t,e){return e=e||t.FarmingShopPlantTotalProduction,l.pow(1.25,e)},calcProdOutput:function(t,e){var a=t.totalMade,o=(t.created,e.manualHarvestFormula,e.shopProdBonus),r=t.prestige,i=l.multiplyDecimal(l.multiplyDecimal(o,1),e.contagionPlantProd),n=t.futureMult,s=l.multiplyDecimal(l.multiplyDecimal(l.multiplyDecimal(a,n),i),l.createDecimal(Math.pow(1.02,r)));return 1===t.ID&&(s=l.multiplyDecimal(s,e.hpBonus)),s},calcFryOutput:function(t){var e=l.logDecimal(t,10),a=l.subtractDecimal(l.logDecimal(t,10),15.75),o=e;o=o.lessThan(31)?o:31;var r=l.subtractDecimal(l.createDecimal(36),o),i=l.pow(l.createDecimal(1.15),l.subtractDecimal(e,16));return l.multiplyDecimal(a,l.multiplyDecimal(r,i))},calcCarryOverEXP_OLD:function(t){var e=t.plant,a=t.numAutos,o=t.expTick,r=0,i=1;if(a>1){var n=o/a,l=Math.ceil((e.reqExp-e.curExp)/n);if(a>l){r=(a-l)*n;for(var s=10+5*(e.Rank+i)*Math.pow(1.05,e.Rank+i);r>s;)r-=s,i++,s=10+5*(e.Rank+i)*Math.pow(1.05,e.Rank+i)}else r=0}else r=0;return{leftOver:r,numLevels:i,reqExp:10+5*(e.Rank+i)*Math.pow(1.05,e.Rank+i)}},calcCarryOverEXP:function(t){for(var e=t.plant,a=t.numAutos,o=t.expTick,r=0,i=e.curExp+a*o,n=10+5*(e.Rank+r)*Math.pow(1.05,e.Rank+r);i>=n;)i-=n,r++,n=10+5*(e.Rank+r)*Math.pow(1.05,e.Rank+r);return{leftOver:i,numLevels:r,reqExp:n}},futureMultBD:function(t,e){return l.pow(1+.05*(1+.02*e.manualHarvestFormula),l.logDecimal(t.created,1.25))},calcFutureMult:function(t,e){var a=!1===e.string?t:JSON.parse(JSON.stringify(t)),o=!1===e.string?e:JSON.parse(JSON.stringify(e)),r=o.time,i=o.numAuto||0===(null===o||void 0===o?void 0:o.numAuto)?o.numAuto:1,n=a.prestigeBonus*o.expBonus;for(a.growthTime=Math.floor(a.TimeNeeded/a.prestigeBonus/(1+.05*o.shopGrowingSpeed)/o.petPlantCombo/o.contagionPlantGrowth),a.growthTime<10&&(a.growthTime=10);r>0;){a.timeToLevel=this.calcTimeTillLevel(a,o);var s=0,c=!1;a.timeToLevel>r?s=r:(s=a.timeToLevel,c=!0),r-=s,a.elapsedTime+=s;var u=0;if(a.elapsedTime>=a.growthTime){u=Math.floor(a.elapsedTime/a.growthTime);var p=a.perHarvest*u*i;if(a.created=l.addDecimal(a.created,p),a.totalMade=l.addDecimal(a.totalMade,p),a.futureMult=this.futureMultBD(a,o),c){var m=this.calcCarryOverEXP({plant:a,expTick:n,numAutos:i});a.curExp=m.leftOver,a.Rank+=m.numLevels,a.perHarvest=this.calcPlantHarvest(a,o),a.reqExp=m.reqExp}else{var d=u*n*i,h=a.curExp+d;a.curExp=h}a.elapsedTime=a.elapsedTime%a.growthTime}}var v=this.calcProdOutput(a,o);return a.production=v,a},calcTimeTillLevel:function(t,e){var a=t,o=e,r=o.numAuto||0===(null===o||void 0===o?void 0:o.numAuto)?o.numAuto:1,i=a.reqExp-a.curExp,n=a.prestigeBonus*o.expBonus*r;return Math.ceil(i/n)*a.growthTime-a.elapsedTime},getNextShopCosts:function(t){var e=t.FarmingShopPlantTotalProduction||0===t.FarmingShopPlantTotalProduction?t.FarmingShopPlantTotalProduction:t.shopProdLevel,a=t.FarmingShopPlantGrowingSpeed||0===t.FarmingShopPlantGrowingSpeed?t.FarmingShopPlantGrowingSpeed:t.shopGrowingSpeed,o=t.FarmingShopPlantRankExpEarned||0===t.FarmingShopPlantRankExpEarned?t.FarmingShopPlantRankExpEarned:t.shopRankLevel,r=l.pow(1.05,e-50),i=l.multiplyDecimal(100,r),n=l.pow(i,e),s=l.multiplyDecimal(1e8,n);return{prodCost:e>50?s:l.multiplyDecimal(1e8,l.pow(100,e)),growthCost:1e10*Math.pow(500,a),expCost:1e15*Math.pow(250,o)}},calcMaxPrestige:function(t){for(var e=t.prestige,a=0,o=!0;o;){var r=10*Math.pow(2,e),i=a+r;t.created.greaterThanOrEqualTo(i)?(e++,a+=r):o=!1}return e-t.prestige},calcTimeTillPrestige:function(t,e){var a=JSON.parse(JSON.stringify(t));this.resetPlantBD(a);var o=JSON.parse(JSON.stringify(e));this.resetModifiersBD(o);for(var r=o.numAuto||0===(null===o||void 0===o?void 0:o.numAuto)?o.numAuto:1,i=!1,n=0,s=0,c=a.prestigeBonus*o.expBonus;!i;){var u=this.calcTimeTillLevel(a,o),p=10*Math.pow(2,a.prestige),m=s+p,d=l.subtractDecimal(m,a.created),h=l.multiplyDecimal(l.divideDecimal(d,a.perHarvest*r),a.growthTime).ceil().toNumber();if(h<=0)i=!0,n<=0&&(a.prestige++,i=!1,s+=p);else if(h>u){a.elapsedTime+=u;var v=Math.floor(a.elapsedTime/a.growthTime);a.created=l.addDecimal(a.created,v*a.perHarvest*r),a.totalMade=l.addDecimal(a.totalMade,v*a.perHarvest*r);var g=this.calcCarryOverEXP({plant:a,numAutos:r,expTick:c});a.Rank+=g.numLevels,a.curExp=g.leftOver,a.reqExp=g.reqExp,a.perHarvest=this.calcPlantHarvest(a,o),n+=u,a.elapsedTime=a.elapsedTime%a.growthTime}else{i=!0,a.elapsedTime+=h;var P=Math.floor(a.elapsedTime/a.growthTime);a.created=l.addDecimal(a.created,P*a.perHarvest*r),a.totalMade=l.addDecimal(a.totalMade,P*a.perHarvest*r),n+=h,a.elapsedTime=a.elapsedTime%a.growthTime}}return{remainingTime:n,prestige:a.prestige,prestiged:i}},resetPlantBD:function(t){var e,a,o,r,i,n;t.totalMade=null!==t&&void 0!==t&&null!==(e=t.totalMade)&&void 0!==e&&e.mantissa||0===(null===t||void 0===t||null===(a=t.totalMade)||void 0===a?void 0:a.mantissa)?t.totalMade:l.createDecimal(t.totalMade),t.created=null!==t&&void 0!==t&&null!==(o=t.created)&&void 0!==o&&o.mantissa||0===(null===t||void 0===t||null===(r=t.created)||void 0===r?void 0:r.mantissa)?t.created:l.createDecimal(t.created),t.production=null!==t&&void 0!==t&&null!==(i=t.production)&&void 0!==i&&i.mantissa||0===(null===t||void 0===t||null===(n=t.production)||void 0===n?void 0:n.mantissa)?t.production:l.createDecimal(t.production),t.futureMult=l.createDecimal(t.futureMult)},resetModifiersBD:function(t){var e,a,o,r,i,n,s;t.shopProdBonus=null!==t&&void 0!==t&&null!==(e=t.shopProdBonus)&&void 0!==e&&e.mantissa||0===(null===t||void 0===t||null===(a=t.shopProdBonus)||void 0===a?void 0:a.mantissa)?t.shopProdBonus:l.createDecimal(t.shopProdBonus),t.hpBonus=null!==t&&void 0!==t&&null!==(o=t.hpBonus)&&void 0!==o&&o.mantissa||0===(null===t||void 0===t||null===(r=t.hpBonus)||void 0===r?void 0:r.mantissa)?t.hpBonus:l.createDecimal(t.hpBonus),t.curPotatoes=null!==t&&void 0!==t&&null!==(i=t.curPotatoes)&&void 0!==i&&i.mantissa||0===(null===t||void 0===t?void 0:t.curPotatoes.mantissa)?t.curPotatoes:l.createDecimal(t.curPotatoes),t.totalPotatoes=null!==t&&void 0!==t&&null!==(n=t.totalPotatoes)&&void 0!==n&&n.mantissa||0===(null===t||void 0===t||null===(s=t.totalPotatoes)||void 0===s?void 0:s.mantissa)?t.totalPotatoes:l.createDecimal(t.totalPotatoes)},calcHPProd:function(t,e){for(var a=JSON.parse(JSON.stringify(t)),r=0;r<a.length;r++)this.resetPlantBD(a[r]);var n=JSON.parse(JSON.stringify(e));this.resetModifiersBD(n),n.nextCosts.prodCost=l.createDecimal(n.nextCosts.prodCost),n.nextCosts.growthCost=l.createDecimal(n.nextCosts.growthCost),n.nextCosts.expCost=l.createDecimal(n.nextCosts.expCost);for(var c=n.numAutos,u=n.time,p=n.startTime?n.startTime:0,m=n.runningTime?n.runningTime:0,d=n.maxSteps?n.maxSteps:100,h=n.tickStart?n.tickStart:0,v=n.tickRate?n.tickRate:60,g=n.dataPointThreshold?n.dataPointThreshold:u/v<d?1:i.roundInt(u/v/d),P=[],f=[],D=n.totalPotatoes,T=n.curPotatoes,M=Array(a.length).fill(0),w=0;w<a.length;w++)M[w]=a[w].production;for(var S=0,x=!1;S<u/v||x;S++){for(var C=a.length-1;C>=0;C--){var B=a[C],k=C===a.length-1?0:v>1?l.multiplyDecimal(l.addDecimal(M[C+1],a[C+1].production),.5*v):l.multiplyDecimal(a[C+1].production,v);B.totalMade=l.addDecimal(B.totalMade,k);var O=this.calcFutureMult(B,(0,o.Z)((0,o.Z)({},n),{},{time:v,numAuto:c[C],string:!1}));a[C]=O,M[C]=a[C].production}var y=i.roundInt(S*v+p);if(D=l.addDecimal(D,l.multiplyDecimal(a[0].production,v)),T=l.addDecimal(T,l.multiplyDecimal(a[0].production,v)),n.autoBuyPBC){var b=!1;if(!0===T.greaterThanOrEqualTo(n.nextCosts.prodCost)&&(T=l.subtractDecimal(T,n.nextCosts.prodCost),n.shopProdLevel++,n.shopProdBonus=this.calcShopProdBonus(n,n.shopProdLevel),b=!0),!0===T.greaterThanOrEqualTo(n.nextCosts.growthCost)&&(T=l.subtractDecimal(T,n.nextCosts.growthCost),n.shopGrowingSpeed++,b=!0),!0===T.greaterThanOrEqualTo(n.nextCosts.expCost)&&(T=l.subtractDecimal(T,n.nextCosts.expCost),n.shopRankLevel++,n.shopRankEXP=1+.1*n.shopRankLevel,b=!0),b){var E=this.getNextShopCosts(n);n.nextCosts=E}}if(S%g===0&&y>=h&&y<=u+m&&(P.push({time:y,production:D}),f.push({time:y,fries:s.calcFryOutput(D)})),!n.skipFinal){if(x&&y>=u+m)break;!x&&y<u+m&&(x=!0)}}if(S>0&&!n.skipFinal){var L=i.roundInt(S*v+p);if(0===P.length)P.push({time:L,production:D}),f.push({time:L,fries:s.calcFryOutput(D)});else if(P[P.length-1].production!==D&&L>u+m){var F=L-P[P.length-1].time,H=(D-P[P.length-1].production)/F,A=u+m-P[P.length-1].time,R=l.addDecimal(P[P.length-1].production,H*A),N={time:P[P.length-1].time+A,production:R};P.push(N),f.push({time:P[P.length-1].time+A,fries:s.calcFryOutput(R)}),D=R}}return{totalPotatoes:D,potatoeProduction:a[0].production,plants:a,nextCosts:n.nextCosts,dataPointsPotatoes:P,dataPointsFries:f,finalModifiers:n}},calcStepHPProd:function(t,e){for(var a=JSON.parse(JSON.stringify(t)),r=0;r<a.length;r++)this.resetPlantBD(a[r]);var n=JSON.parse(JSON.stringify(e));this.resetModifiersBD(n);for(var l=n.steps,s=-1,c=[],u=0,p=n.maxSteps?n.maxSteps:100,m=n.tickRate?n.tickRate:60,d=e.time/m<p?1:i.roundInt(e.time/m/p),h=0;h<l.length;h++)(n=(s=this.calcHPProd(a,(0,o.Z)((0,o.Z)({},n),{},{numAutos:l[h].autos,time:l[h].time,dataPointThreshold:d,startTime:c.length>0?c[c.length-1].time:0,runningTime:u,skipFinal:h<l.length-1,tickStart:c.length>0?c[c.length-1].time+d*m:0}))).finalModifiers).totalPotatoes=s.totalPotatoes,a=s.plants,c=c.concat(s.dataPointsPotatoes),l[h].obj={text:"P".concat(l.length-h," for ").concat(l[h].time),numAutos:l[h].autos,time:l[h].time},u+=l[h].time;return s.dataPointsPotatoes=c,s.steps=l,s},calcAssemblyHP:function(t){var e=1;if((null===t||void 0===t?void 0:t.AssemblerCollection[0].BonusList[0].StartingLevel)<=(null===t||void 0===t?void 0:t.AssemblerCollection[0].Level)){var a=null===t||void 0===t?void 0:t.AssemblerCollection[0].BonusList[0].Gain,o=(null===t||void 0===t?void 0:t.AssemblerCollection[0].Level)-(null===t||void 0===t?void 0:t.AssemblerCollection[0].BonusList[0].StartingLevel);e=Math.pow(1+a,o)}return e},calcContagionBonus:function(t,e){var a=1;if(t.GrasshopperCollection[e].Locked>0){var o=i.calcPOW(t.GrasshopperCollection[e].BaseBonus),r=i.calcPOW(t.GrasshopperCollection[e].Level);a*=Math.pow(1+.01*o,r)}return a},calcExpeditionHP:function(t){var e=1;if(t.ExpeditionsCollection[16].Locked>0){var a=t.ExpeditionsCollection[16];e=Math.pow(1+a.BonusPower,a.Room-1)}return e},calcUniqueHPBonus:function(t){for(var e=1,a=0;a<t.FarmingShopUniqueHealthy.length;a++)e*=t.FarmingShopUniqueHealthy[a]+1;return e},calcFriesHPBonus:function(t){var e=1;return e*=1+i.calcPOW(t.FrenchFriesTotal)*((.01*t.FarmingShopFriesHealthyBonus+.1)*this.calcContagionBonus(t,5))},calcPetHPBonus:function(t){for(var e=1,a=t.EquipedPetID,o=t.PetsCollection,r={},n=0;n<a.length;n++)a[n]>0&&(r[a[n]]=!0);for(var l=0;l<o.length;l++){var s=o[l];if(s.ID in r){s.Rank;for(var c=0;c<s.BonusList.length;c++){var u=s.BonusList[c];if(23===u.ID){var p=Math.pow(1+u.Gain,s.Level)-1,m=i.calculateLogarithm(1.0125,s.Level+1);e+=.5*((p+Math.max(0,.5*(.005*m-1)))*(1+.005*i.calculateLogarithm(1.075,s.Rank+1)))}}}}return e},calcHPBonus:function(t){return i.calcPOW(t.HealthyPotatoBonus)}},c=s;self.onmessage=function(t){var e=t.data,a=e.data;e.id,e.data1;try{for(var r=a.finalPlants,n=0;n<r.length;n++){var s=r[n];s.created=l.createDecimal(s.created),s.totalMade=l.createDecimal(s.totalMade),s.production=l.createDecimal(s.production)}var u=a.modifiers;u.shopProdBonus=l.createDecimal(u.shopProdBonus),u.hpBonus=l.createDecimal(u.hpBonus),u.curPotatoes=l.createDecimal(u.curPotatoes),u.totalPotatoes=l.createDecimal(u.totalPotatoes);for(var p=a.mode,m=a.time,d=a.numSimulatedAutos?a.numSimulatedAutos:1,h=a.combinations,v=l.createDecimal(0),g={},P=l.createDecimal(0),f={},D=0,T={potatoeProduction:0},M=0,w={potatoeProduction:0},S=(0,o.Z)((0,o.Z)({},u),{},{time:3600*m}),x=[],C=[],B=a.start;B<=a.end;B++){var k=h[B];S.numAutos=k;var O=void 0;switch(p){case"afk":default:O=c.calcHPProd(r,S);break;case"carlo":O=c.calcStepHPProd(r,(0,o.Z)((0,o.Z)({},S),{},{steps:k}));break;case"step":for(var y=[],b=0,E=0,L=0,F=0;F<k.length;F++)k[F]>0&&(E++,L+=k[F]*a.baseTimers[F]);for(var H=3600*m-L,A=0;A<a.baseTimers.length;A++){k[A]>0&&b++;var R=Array(a.baseTimers.length).fill(0);R[A]=d,R.reverse();var N=k[A]*a.baseTimers[A];if(b===E&&k[A]>0)N+=H;else if(k[A]>0){var q=r[r.length-1-A],I=N%q.growthTime;if(I<=.5*q.growthTime)N-=I,H+=I;else{var G=q.growthTime-I;H>=G&&(N+=G,H-=G)}}y.push({time:i.roundInt(N),autos:R})}O=c.calcStepHPProd(r,(0,o.Z)((0,o.Z)({},S),{},{steps:y}))}for(var J=0,Z=0,W=void 0,X=0;X<O.plants.length;X++){var U=c.calcMaxPrestige(O.plants[X]);J+=U,Z+=Math.pow(1.02,O.plants[X].prestige+U)-Math.pow(1.02,O.plants[X].prestige),O.plants[X].picIncrease=U}!0===O.totalPotatoes.greaterThanOrEqualTo(v)&&(v=O.totalPotatoes,g={combo:k,result:O,plants:O.plants},x.unshift({data:O.dataPointsPotatoes,result:v}),x.length>10&&x.pop(),C.unshift({data:O.dataPointsFries,result:v}),C.length>10&&C.pop()),!0===O.potatoeProduction.greaterThanOrEqualTo(P)&&(P=O.potatoeProduction,f={combo:k,result:O,plants:O.plants}),(J>D||J===D&&O.potatoeProduction.greaterThanOrEqualTo(T.potatoeProduction))&&(W={combo:k,result:O,plants:O.plants,potatoeProduction:O.potatoeProduction,picGain:J,picStats:{picLevel:J,picPercent:Z}},D=J,T=W),(Z>M||Z===M&&O.potatoeProduction.greaterThanOrEqualTo(w.potatoeProduction))&&(W={combo:k,result:O,plants:O.plants,potatoeProduction:O.potatoeProduction,picGain:Z,picStats:{picLevel:J,picPercent:Z}},M=Z,w=W),self.postMessage({update:!0,temp:W})}self.postMessage({success:!0,totalPotCombo:g,bestProdCombo:f,bestPicCombo:T,bestPICPercCombo:w,top10DataPointsPotatoes:x,top10DataPointsFries:C})}catch(j){console.log(j)}}}}]);
//# sourceMappingURL=359.a7c5f9d1.chunk.js.map